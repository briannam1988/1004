<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KNDXMH0VS4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-KNDXMH0VS4');
</script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Decision Helper | AI Utility Platform</title>
    <meta name="description" content="Struggling with a tough decision? The AI Decision Helper analyzes pros, cons, key considerations, and recommendation scores to help you make a wise choice." />
    <link rel="stylesheet" href="style.css">
</head>
<body>

<nav class="nav-bar">
    <div class="menu">
        <ul class="nav-links">
            <li><a href="/" data-translate-key="nav_ai_writer"></a></li>
            <li><a href="/decision-helper.html" class="active" data-translate-key="nav_decision_helper"></a></li>
            <li><a href="/calculator.html" data-translate-key="nav_calculator"></a></li>
        </ul>
        <!-- Language switcher will be injected here by i18n.js -->
    </div>
</nav>

<div class="container">
    <div class="header">
        <h1 data-translate-key="decision_title"></h1>
        <p class="subtitle" data-translate-key="decision_subtitle"></p>
    </div>

    <div class="form-grid decision-form">
        <div class="form-group">
            <label for="optionA" data-translate-key="option_a_label"></label>
            <input type="text" id="optionA" placeholder="e.g., iPhone 15 Pro">
        </div>
        <div class="form-group">
            <label for="optionB" data-translate-key="option_b_label"></label>
            <input type="text" id="optionB" placeholder="e.g., Galaxy S24 Ultra">
        </div>
    </div>
    <div class="form-group">
        <label for="decision-context" data-translate-key="decision_context_label"></label>
        <textarea id="decision-context" rows="3" data-translate-key="decision_context_placeholder"></textarea>
    </div>

    <button id="analyzeBtn" onclick="analyzeDecision()" data-translate-key="analyze_button"></button>

    <div id="result-wrapper" style="display: none; margin-top: 30px;">
        <div id="loader" style="display: none; text-align: center; padding: 40px 0;">
             <div class="loader-inner"></div>
             <p data-translate-key="loading_decision_text">AI is deeply analyzing the two options...</p>
        </div>
        
        <div id="decision-result"></div>
    </div>
</div>

<script src="i18n.js"></script>
<script>
    const analyzeBtn = document.getElementById('analyzeBtn');
    const resultWrapper = document.getElementById('result-wrapper');
    const loader = document.getElementById('loader');
    const decisionResult = document.getElementById('decision-result');

    async function analyzeDecision() {
        const optionA = document.getElementById('optionA').value;
        const optionB = document.getElementById('optionB').value;
        const context = document.getElementById('decision-context').value;
        const lang = window.currentLanguage || 'en';
        const originalButtonText = analyzeBtn.innerText;

        if (!optionA || !optionB) {
            alert('Please enter both options.');
            return;
        }

        resultWrapper.style.display = 'block';
        loader.style.display = 'block';
        decisionResult.innerHTML = '';
        analyzeBtn.disabled = true;
        analyzeBtn.innerText = 'AI is analyzing...';

        try {
            const response = await fetch('/analyze-decision', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ optionA, optionB, context, lang })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            renderDecisionResult(data);

        } catch (error) {
            console.error("API call error:", error);
            decisionResult.innerHTML = `<p class="error-message">Analysis failed: ${error.message}</p>`;
        } finally {
            loader.style.display = 'none';
            analyzeBtn.disabled = false;
            analyzeBtn.innerText = originalButtonText;
        }
    }

    function renderDecisionResult(data) {
        if (!data || !data.scores) {
            decisionResult.innerHTML = `<p class="error-message">Did not receive a valid analysis from the AI.</p>`;
            return;
        }

        let tableRows = '';
        data.comparison.forEach(item => {
            tableRows += `
                <tr>
                    <td><strong>${item.criteria}</strong></td>
                    <td>${item.optionA}</td>
                    <td>${item.optionB}</td>
                </tr>
            `;
        });
        
        // Disclaimer and other texts can also be translated if you add them to your JSON files
        decisionResult.innerHTML = `
            <div class="disclaimer">
                <p><strong data-translate-key="disclaimer_title"></strong> <span data-translate-key="disclaimer_text"></span></p>
            </div>
            
            <div class="recommendation-summary">
                <h3><span data-translate-key="recommendation_title"></span> <span class="highlight">${data.recommendation}</span></h3>
                <p>${data.summary}</p>
            </div>

            <div class="score-board">
                <h4 data-translate-key="score_title"></h4>
                <div class="score-item">
                    <label>${data.scores.optionA.name}</label>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: ${data.scores.optionA.score}%;">${data.scores.optionA.score}</div>
                    </div>
                </div>
                <div class="score-item">
                    <label>${data.scores.optionB.name}</label>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: ${data.scores.optionB.score}%; background-color: #5a9bd5;">${data.scores.optionB.score}</div>
                    </div>
                </div>
            </div>

            <div class="comparison-table">
                <h4 data-translate-key="comparison_title"></h4>
                <table>
                    <thead>
                        <tr>
                            <th data-translate-key="criteria_header"></th>
                            <th>${data.scores.optionA.name}</th>
                            <th>${data.scores.optionB.name}</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tableRows}
                    </tbody>
                </table>
            </div>

            <div class="reasoning-section">
                <h4 data-translate-key="reasoning_title"></h4>
                <p>${data.reasoning}</p>
            </div>
        `;
        // We need to re-apply translations for the newly added dynamic content
        applyTranslations(window.currentLanguage || 'en');
    }
</script>

</body>
</html>
