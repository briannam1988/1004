<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KNDXMH0VS4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-KNDXMH0VS4');
</script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Text Generator | AI Utility Platform</title>
    <meta name="description" content="AI suggests 3 versions of perfect text in real-time for any situation, audience, tone, and length. Solve all your writing difficulties, from reports and emails to apologies and requests." />
    <link rel="stylesheet" href="style.css">
</head>
<body>

<nav class="nav-bar">
    <div class="menu">
        <ul class="nav-links">
            <li><a href="/" class="active" data-translate-key="nav_ai_writer"></a></li>
            <li><a href="/decision-helper.html" data-translate-key="nav_decision_helper"></a></li>
            <li><a href="/calculator.html" data-translate-key="nav_calculator"></a></li>
        </ul>
        <!-- Language switcher will be injected here by i18n.js -->
    </div>
</nav>

<div class="container">
    <div class="header">
        <h1 data-translate-key="writer_title"></h1>
        <p class="subtitle" data-translate-key="writer_subtitle"></p>
    </div>

    <div class="form-grid">
        <div class="form-group">
            <label for="situation" data-translate-key="situation_label"></label>
            <select id="situation">
                <optgroup label="Work">
                    <option value="report_progress">Progress Report</option>
                    <option value="report_result">Result Report</option>
                    <option value="request_data">Data Request</option>
                    <option value="request_feedback">Feedback Request</option>
                    <option value="rejection_polite">Polite Rejection</option>
                    <option value="meeting_request">Meeting Request</option>
                </optgroup>
                <optgroup label="Daily Life">
                    <option value="apology_late">Apology for being late/changing plans</option>
                    <option value="appreciation">Thank you message</option>
                    <option value="congratulation">Congratulations (birthday, promotion, etc.)</option>
                    <option value="condolence">Condolence/Encouragement</option>
                </optgroup>
            </select>
        </div>

        <div class="form-group">
            <label for="target" data-translate-key="target_label"></label>
            <select id="target">
                <option value="boss">Boss/Senior</option>
                <option value="colleague">Colleague</option>
                <option value="junior">Junior/Subordinate</option>
                <option value="client">Client/Customer</option>
                <option value="friend">Friend/Family</option>
            </select>
        </div>

        <div class="form-group">
            <label for="length" data-translate-key="length_label"></label>
            <select id="length">
                <option value="short">Short (1-2 sentences)</option>
                <option value="medium" selected>Medium (3-5 sentences)</option>
                <option value="long">Long (Email format)</option>
            </select>
        </div>

        <div class="form-group">
            <label for="tone" data-translate-key="tone_label"></label>
            <select id="tone">
                <option value="polite">Formal and Polite</option>
                <option value="casual">Friendly and Gentle</option>
                <option value="direct">Concise and Clear</option>
                <option value="witty">Witty and Humorous</option>
            </select>
        </div>
    </div>

    <div class="form-group">
        <label for="detail" data-translate-key="detail_label"></label>
        <textarea id="detail" rows="4" data-translate-key="detail_placeholder"></textarea>
    </div>

    <button id="generateBtn" onclick="generateText()" data-translate-key="generate_button"></button>

    <div class="result-section">
        <h2 data-translate-key="result_title"></h2>
        <div id="loader" style="display: none;">
            <div class="loader-inner"></div>
            <p>AI is creating the 3 best text options...</p>
        </div>
        <div id="result-cards-container"></div>
    </div>

    <div class="history-section">
        <h2 data-translate-key="history_title"></h2>
        <ul id="history-list"></ul>
    </div>
</div>

<script src="i18n.js"></script>
<script>
    const generateBtn = document.getElementById('generateBtn');
    const resultCardsContainer = document.getElementById('result-cards-container');
    const loader = document.getElementById('loader');
    const historyList = document.getElementById('history-list');

    const situationSelect = document.getElementById('situation');
    const targetSelect = document.getElementById('target');
    const lengthSelect = document.getElementById('length');
    const toneSelect = document.getElementById('tone');
    const detailTextarea = document.getElementById('detail');

    document.addEventListener('DOMContentLoaded', () => loadHistory());

    async function generateText() {
        const [situation, target, length, tone, detail] = [situationSelect.value, targetSelect.value, lengthSelect.value, toneSelect.value, detailTextarea.value];
        const originalButtonText = generateBtn.innerText;

        resultCardsContainer.innerHTML = '';
        loader.style.display = 'block';
        generateBtn.disabled = true;
        generateBtn.innerText = 'AI is thinking...';

        try {
            const response = await fetch('/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ situation, target, length, tone, detail })
            });

            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

            const data = await response.json();
            const texts = data.generatedTexts;

            if (!texts || !Array.isArray(texts) || texts.length === 0) {
                throw new Error("Did not receive a valid response from the server.");
            }

            displayResultCards(texts);
            saveToHistory({ inputs: { situation, target, length, tone, detail }, outputs: texts });

        } catch (error) {
            console.error("API call error:", error);
            resultCardsContainer.innerHTML = `<p class="error-message">Failed to generate text. Please try again later.</p>`;
        } finally {
            loader.style.display = 'none';
            generateBtn.disabled = false;
            generateBtn.innerText = originalButtonText;
        }
    }

    function displayResultCards(texts) {
        resultCardsContainer.innerHTML = '';
        texts.forEach((text, index) => {
            const card = document.createElement('div');
            card.className = 'result-card';
            card.innerHTML = `
                <div class="card-header">
                    <h3>AI Suggestion ${index + 1}</h3>
                    <button class="copy-btn" onclick="copyText(this)">Copy</button>
                </div>
                <p class="card-text">${text.replace(/\n/g, '<br>')}</p>
            `;
            resultCardsContainer.appendChild(card);
        });
    }

    function copyText(buttonElement) {
        const cardText = buttonElement.closest('.result-card').querySelector('.card-text').innerText;
        navigator.clipboard.writeText(cardText).then(() => {
            buttonElement.innerText = 'Copied!';
            setTimeout(() => { buttonElement.innerText = 'Copy'; }, 2000);
        }).catch(err => console.error('Copy failed', err));
    }

    function saveToHistory(record) {
        let history = JSON.parse(localStorage.getItem('generationHistoryV2')) || [];
        history.unshift(record);
        if (history.length > 5) history.pop();
        localStorage.setItem('generationHistoryV2', JSON.stringify(history));
        loadHistory();
    }
    
    function loadHistory() {
        historyList.innerHTML = '';
        const history = JSON.parse(localStorage.getItem('generationHistoryV2')) || [];
        history.forEach(record => {
            const li = document.createElement('li');
            li.className = 'history-item';
            const inputText = `[${record.inputs.situation}] ${record.inputs.detail.substring(0, 30)}...`;
            li.innerText = inputText;
            li.onclick = () => {
                situationSelect.value = record.inputs.situation;
                targetSelect.value = record.inputs.target;
                lengthSelect.value = record.inputs.length;
                toneSelect.value = record.inputs.tone;
                detailTextarea.value = record.inputs.detail;
                displayResultCards(record.outputs);
                window.scrollTo(0, 0);
            };
            historyList.appendChild(li);
        });
    }
</script>

</body>
</html>
