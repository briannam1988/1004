<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Content Tools</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header>
        <h1>AI-Powered Content Suite</h1>
        <p>Generate, analyze, and calculate with the power of AI.</p>
    </header>

    <main>
        <!-- Phrase Generation Section -->
        <section id="phrase-generator" class="tool-section">
            <h2><span class="icon">âœ¨</span> AI Copy Generator</h2>
            <p>Create compelling marketing copy for any product or service.</p>
            <div class="input-group">
                <label for="detail">Enter your product/service description:</label>
                <textarea id="detail" placeholder="e.g., A new coffee shop that serves artisanal, single-origin beans."></textarea>

                <div class="flex-row">
                    <div class="input-col">
                        <label for="situation">Situation</label>
                        <select id="situation">
                            <option value="social_media">Social Media Post</option>
                            <option value="email_newsletter">Email Newsletter</option>
                            <option value="product_description">Product Description</option>
                        </select>
                    </div>
                    <div class="input-col">
                        <label for="target">Target Audience</label>
                        <select id="target">
                            <option value="general">General Audience</option>
                            <option value="young_adults">Young Adults (18-25)</option>
                            <option value="professionals">Professionals (30-50)</option>
                        </select>
                    </div>
                </div>
                 <div class="flex-row">
                    <div class="input-col">
                        <label for="length">Length</label>
                        <select id="length">
                            <option value="short">Short</option>
                            <option value="medium">Medium</option>
                            <option value="long">Long</option>
                        </select>
                    </div>
                    <div class="input-col">
                        <label for="tone">Tone</label>
                        <select id="tone">
                            <option value="professional">Professional</option>
                            <option value="friendly">Friendly</option>
                            <option value="humorous">Humorous</option>
                        </select>
                    </div>
                </div>

                <button id="generate-btn">Generate 3 Phrases</button>
            </div>
            <div id="result-wrapper" class="result-box-container" style="display: none;">
                <h3>AI Suggestions (3 Versions)</h3>
                <div id="result-cards-container" class="result-box">
                    <!-- Results will be injected here -->
                </div>
                <div class="loader-container">
                    <div class="loader" style="display: none;"></div>
                </div>
            </div>
        </section>

    </main>

    <footer>
        <p>&copy; 2024 AI Content Tools. All rights reserved.</p>
    </footer>

    <!-- Firebase SDKs -->
    <script src="/__/firebase/9.6.1/firebase-app-compat.js"></script>
    <script src="/__/firebase/9.6.1/firebase-functions-compat.js"></script>
    <script src="/__/firebase/init.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Element References ---

            const generateBtn = document.getElementById('generate-btn');
            const situationSelect = document.getElementById('situation');
            const targetSelect = document.getElementById('target');
            const lengthSelect = document.getElementById('length');
            const toneSelect = document.getElementById('tone');
            const detailTextarea = document.getElementById('detail');

            const resultWrapper = document.getElementById('result-wrapper');
            const resultCardsContainer = document.getElementById('result-cards-container');
            const loader = document.querySelector('.loader');

            // --- Event Listener ---
            generateBtn.addEventListener('click', async () => {
                const situation = situationSelect.value;
                const target = targetSelect.value;
                const length = lengthSelect.value;
                const tone = toneSelect.value;
                const detail = detailTextarea.value;
                const lang = 'en'; // Hard-coded for now
                const originalButtonText = generateBtn.innerText;

                if (!detail) {
                    alert('Please enter a description.');
                    return;
                }

                // --- Show loader and disable button ---
                resultWrapper.style.display = 'block';
                loader.style.display = 'block';
                resultCardsContainer.innerHTML = '';
                generateBtn.disabled = true;
                generateBtn.innerText = 'AI is thinking...';

                try {
                    // Get a reference to the callable function
                    const generate = firebase.functions().httpsCallable('generate');

                    // Call the function with the data object
                    const response = await generate({ situation, target, length, tone, detail, lang });

                    // The result from a callable function is in response.data
                    const resultText = response.data.result;

                    if (resultText) {
                        const versions = resultText.split('\n').filter(v => v.trim() !== '');
                        let html = '';
                        versions.forEach((version, index) => {
                            // Remove numbering like "1. " from the start of the line
                            const cleanVersion = version.replace(/^\d+\.\s*/, '');
                            html += `<div class="result-card"><h4>Version ${index + 1}</h4><p>${cleanVersion}</p></div>`;
                        });
                        resultCardsContainer.innerHTML = html;
                    } else {
                        resultCardsContainer.innerHTML = '<p class="error">The AI returned an empty response.</p>';
                    }

                } catch (error) {
                    console.error('Error calling generate function:', error);
                    resultCardsContainer.innerHTML = `<p class="error">An error occurred: ${error.message}</p>`;
                } finally {
                    // --- Hide loader and re-enable button ---
                    loader.style.display = 'none';
                    generateBtn.disabled = false;
                    generateBtn.innerText = originalButtonText;
                }
            });
        });
    </script>

</body>
</html>
